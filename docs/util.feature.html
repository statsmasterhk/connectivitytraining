<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>util.feature module &mdash; Connectivity Training  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="util.logger module" href="util.logger.html" />
    <link rel="prev" title="util.config module" href="util.config.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Connectivity Training
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">connectivitytraining</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="datasets.html">datasets package</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html">model package</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="util.html">util package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="util.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="util.config.html">util.config module</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">util.feature module</a></li>
<li class="toctree-l4"><a class="reference internal" href="util.logger.html">util.logger module</a></li>
<li class="toctree-l4"><a class="reference internal" href="util.result.html">util.result module</a></li>
<li class="toctree-l4"><a class="reference internal" href="util.train_helper.html">util.train_helper module</a></li>
<li class="toctree-l4"><a class="reference internal" href="util.video_util.html">util.video_util module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="util.html#module-util">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Connectivity Training</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">connectivitytraining</a></li>
          <li class="breadcrumb-item"><a href="util.html">util package</a></li>
      <li class="breadcrumb-item active">util.feature module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/util.feature.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-util.feature">
<span id="util-feature-module"></span><h1>util.feature module<a class="headerlink" href="#module-util.feature" title="Permalink to this heading"></a></h1>
<p>A Direct copy from Tracking/Models/ReID.py preprocess function</p>
<dl class="py function">
<dt class="sig sig-object py" id="util.feature.box2im">
<span class="sig-prename descclassname"><span class="pre">util.feature.</span></span><span class="sig-name descname"><span class="pre">box2im</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">box</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util/feature.html#box2im"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#util.feature.box2im" title="Permalink to this definition"></a></dt>
<dd><p>obtain the image from the bounding box</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.feature.get_feature">
<span class="sig-prename descclassname"><span class="pre">util.feature.</span></span><span class="sig-name descname"><span class="pre">get_feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">caps</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util/feature.html#get_feature"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#util.feature.get_feature" title="Permalink to this definition"></a></dt>
<dd><p>Obtain the feature vectors for the jockey caps with the re-identification network.
This network generates cap feature vector of length 128 for re-identification purposes. Euclidean distance can be computed between the cap features. The shorter the distance, the more likely the caps belong to the same jockey</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_dir</strong> (<em>str</em>) – The directory to the release models, usually on dropbox or company server</p></li>
<li><p><strong>track</strong> (<em>str</em>) – The track name, i.e. ‘HVT’, ‘STT’, ‘Kranji’</p></li>
<li><p><strong>caps</strong> (<em>list</em><em> of </em><em>images</em>) – The cap images</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>feats</strong> – Feature vectors of shape 128</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy array of float32</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Post-processing:      Normalisation on the output is necessary for it to be comparible. code ‘embed = ip_feat / np.linalg.norm(ip_feat, 2, 1, True)’</p>
<p>Network structure:    Inception v1 backbone + Triplet Loss</p>
<p>Future Work:          Re-training the model with a more advanced architecture like the one in jockey re-identification and reduce the size of the input</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.feature.pdist_np">
<span class="sig-prename descclassname"><span class="pre">util.feature.</span></span><span class="sig-name descname"><span class="pre">pdist_np</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">emb1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">emb2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util/feature.html#pdist_np"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#util.feature.pdist_np" title="Permalink to this definition"></a></dt>
<dd><p>compute the eucilidean distance matrix between embeddings1 and embeddings2
using cpu</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.feature.pdist_torch">
<span class="sig-prename descclassname"><span class="pre">util.feature.</span></span><span class="sig-name descname"><span class="pre">pdist_torch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">emb1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">emb2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util/feature.html#pdist_torch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#util.feature.pdist_torch" title="Permalink to this definition"></a></dt>
<dd><p>compute the eucilidean distance matrix between embeddings1 and embeddings2
using gpu</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.feature.preprocess">
<span class="sig-prename descclassname"><span class="pre">util.feature.</span></span><span class="sig-name descname"><span class="pre">preprocess</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">px_mean</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util/feature.html#preprocess"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#util.feature.preprocess" title="Permalink to this definition"></a></dt>
<dd><p>Preprocessing the list of images and return a numpy array of preprocessed images.
Preproccsing involves:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>convert the image to float</p></li>
<li><p>subtract the pixel mean [104, 117, 123] from the image</p></li>
<li><p>Resize the image into size (224, 224, 3)</p></li>
<li><p>assign the image to the ndarray</p></li>
</ol>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>list</em><em> of </em><em>images</em>) – The cap images to be pre-processed</p></li>
<li><p><strong>px_mean</strong> (<em>list</em><em> of </em><em>3 elements</em>) – The pixel mean [104, 117, 123]. This mean will be subtracted from the input image to normalise the image</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>out</strong> – The preprocessed images</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy array of float32</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="util.feature.triplet_feature_to_list">
<span class="sig-prename descclassname"><span class="pre">util.feature.</span></span><span class="sig-name descname"><span class="pre">triplet_feature_to_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat_npy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detected_boxes</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/util/feature.html#triplet_feature_to_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#util.feature.triplet_feature_to_list" title="Permalink to this definition"></a></dt>
<dd><p>convert the structure of the triplet feature into the same as detected_boxes, i.e. list of list of features</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feat_npy</strong> (<em>numpy array</em>) – triplet feature in the shape of (total item number, feature_vector_size). If the detected caps are 10000, then, shape is (10000, 128) If the detected jockeys are 8000, then shape is (8000, 2048).
Note the difference in feature vector size, as the caps triplet model is still the old one.</p></li>
<li><p><strong>detected_boxes</strong> (<em>list</em><em> of </em><em>list</em><em> of </em><em>list</em>) – for every frame, for every cap/jockey, there is a bounding box</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>feat_list</strong> – the triplet feature arranged in similar format as detected_boxes</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of list of vector(numpy array)</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="util.config.html" class="btn btn-neutral float-left" title="util.config module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="util.logger.html" class="btn btn-neutral float-right" title="util.logger module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Statsmaster Ltd..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>